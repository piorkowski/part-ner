{% extends "base.html.twig" %}
{% block content %}

  {% if content.description %}
  <section class="section-wrap pt-80 pb-40">
    <div class="container">
      <div class="row">
        <div class="col-md-8 col-md-offset-2 text-center">
          <div class="contact-description">{{ content.description|raw }}</div>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <section class="section-wrap pb-80 {% if not content.description %}pt-80{% else %}pt-40{% endif %}">
    <div class="container">
      <div class="row">

        <div class="col-md-4 mb-50">
          <div class="contact-info">
            <h3 class="uppercase mb-30">{{ 'contact.info'|trans }}</h3>
            {% if content.company_name %}
              <div class="contact-info-item"><i class="ti-home"></i><div><strong>{{ content.company_name }}</strong></div></div>
            {% endif %}
            {% if content.address %}
              <div class="contact-info-item"><i class="ti-location-pin"></i><div><strong>{{ 'contact.address'|trans }}</strong><br>{{ content.address|nl2br }}</div></div>
            {% endif %}
            {% if content.phone %}
              <div class="contact-info-item"><i class="ti-mobile"></i><div><strong>{{ 'contact.phone'|trans }}</strong><br><a href="tel:{{ content.phone|replace({' ': '', '-': ''}) }}">{{ content.phone }}</a></div></div>
            {% endif %}
            {% if content.email %}
              <div class="contact-info-item"><i class="ti-email"></i><div><strong>{{ 'contact.email'|trans }}</strong><br><a href="mailto:{{ content.email }}">{{ content.email }}</a></div></div>
            {% endif %}
            {% if content.working_hours %}
              <div class="contact-info-item"><i class="ti-time"></i><div><strong>{{ 'contact.working_hours'|trans }}</strong><br>{{ content.working_hours|nl2br }}</div></div>
            {% endif %}
          </div>
        </div>

        <div class="col-md-8 mb-50">
          <div class="panel panel-default panel-contact">
            <div class="panel-heading"><h3 class="uppercase mb-0">{{ 'contact.send_message'|trans }}</h3></div>
            <div class="panel-body">
              <form class="contact-form" method="post" action="{{ path('contact_form_submit') }}" id="contactForm" novalidate>
                <div class="row">
                  <div class="col-md-6"><div class="form-group"><input type="text" class="form-control" name="name" placeholder="{{ 'contact.form.name'|trans }}" required></div></div>
                  <div class="col-md-6"><div class="form-group"><input type="email" class="form-control" name="email" placeholder="{{ 'contact.form.email'|trans }}" required></div></div>
                </div>
                <div class="row">
                  <div class="col-md-6"><div class="form-group"><input type="text" class="form-control" name="phone" placeholder="{{ 'contact.form.phone'|trans }}"></div></div>
                  <div class="col-md-6"><div class="form-group"><input type="text" class="form-control" name="company" placeholder="{{ 'contact.form.company'|trans }}"></div></div>
                </div>
                <div class="form-group"><input type="text" class="form-control" name="subject" placeholder="{{ 'contact.form.subject'|trans }}" required></div>
                <div class="form-group"><textarea class="form-control" name="message" rows="7" placeholder="{{ 'contact.form.message'|trans }}" required></textarea></div>
                <div class="form-group"><div class="checkbox"><label><input type="checkbox" name="gdpr" required> {{ 'contact.form.gdpr'|trans }}</label></div></div>
                <input type="hidden" name="recipient" value="{{ content.form_recipient }}">
                <input type="hidden" name="locale" value="{{ app.request.locale }}">
                <button type="submit" class="btn btn-lg btn-dark btn-submit"><i class="ti-email"></i> {{ 'contact.form.send'|trans }}</button>
                <div class="form-message mt-20"></div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  {% if content.map_embed %}
  <section class="section-wrap p-0"><div class="google-map">{{ content.map_embed|raw }}</div></section>
  {% endif %}

  <style>
    .contact-info-item{display:flex;align-items:flex-start;margin-bottom:25px;padding-bottom:25px;border-bottom:1px solid #eee}
    .contact-info-item:last-child{border-bottom:none}
    .contact-info-item i{font-size:24px;color:#667eea;margin-right:20px;margin-top:3px}
    .contact-info-item a{color:#333;text-decoration:none;transition:color .3s}
    .contact-info-item a:hover{color:#667eea}
    .contact-form .form-control{height:50px;border:2px solid #eee;padding:0 20px;font-size:14px;transition:border-color .3s}
    .contact-form textarea.form-control{height:auto;padding:15px 20px}
    .contact-form .form-control:focus{border-color:#667eea;outline:none;box-shadow:none}
    .contact-form .btn-submit{position:relative}
    .contact-form .btn-submit.loading{pointer-events:none;opacity:.7}
    .contact-form .btn-submit.loading:after{content:'';position:absolute;width:16px;height:16px;top:50%;right:20px;margin-top:-8px;border:2px solid #fff;border-radius:50%;border-right-color:transparent;animation:spinner .6s linear infinite}
    @keyframes spinner{to{transform:rotate(360deg)}}
    .form-message .alert{margin-top:20px}
    .google-map{width:100%;height:450px}
    .google-map iframe{width:100%;height:100%;border:0}
    .checkbox label{font-weight:normal;font-size:13px;color:#666}
    .panel-contact .panel-heading{background:#fff;border-bottom:1px solid #eee}
    .panel-contact .panel-body{padding:25px}
    .form-control.error{border-color:#e74c3c}
  </style>

  {% block javascripts %}
    {{ parent() }}
    <script>
      $(function(){
        function isEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
        $('#contactForm').on('submit', function(e){
          e.preventDefault();
          var $f=$(this), ok=true, $msg=$f.find('.form-message'), $btn=$f.find('.btn-submit');
          $msg.html('');
          $f.find('[required]').each(function(){
            var $i=$(this), v=$i.val().trim();
            if(!v || ($i.attr('type')==='email' && !isEmail(v))){ ok=false; $i.addClass('error'); }
            else { $i.removeClass('error'); }
          });
          if(!ok){ $msg.html('<div class="alert alert-danger">{{ 'contact.form.error_required'|trans }}</div>'); return; }
          $btn.addClass('loading');
          $.ajax({ type:'POST', url:$f.attr('action'), data:$f.serialize() })
            .done(function(){ $msg.html('<div class="alert alert-success"><i class="ti-check"></i> {{ 'contact.form.success'|trans }}</div>'); $f[0].reset(); })
            .fail(function(){ $msg.html('<div class="alert alert-danger"><i class="ti-close"></i> {{ 'contact.form.error_send'|trans }}</div>'); })
            .always(function(){ $btn.removeClass('loading'); $('html,body').animate({scrollTop:$msg.offset().top-100}, 400); });
        });
        $('#contactForm [required]').on('input change', function(){ $(this).removeClass('error'); });
        var urlParams=new URLSearchParams(window.location.search); var product=urlParams.get('product');
        if(product){ $('#contactForm input[name="subject"]').val('{{ 'contact.form.inquiry_about'|trans }}: ' + product); }
      });
    </script>
  {% endblock %}

{% endblock %}
